# Web API Endpoints Documentation

## 1. Login/Register

Endpoints for users register and log in.

### Database Schemas

The resources for both user's registration and user's log in

#### Users
| Field    | Data Type        | Metadata                                            |
| -------- | -----------------| --------------------------------------------------- |
| id       | unsigned integer | primary key, auto-increments, generated by database |
| username | string           | required, unique, max 128 characters                |
| password | string           | required                                            |
| role     | string           | required, default value 'user'                      |

### Register

#### Endpoint

```sh
POST /api/auth/register
URL: https://build-week-expat-journal-1.herokuapp.com/api/auth/register
```

#### Request Body

request object:
```sh
{ 
  username: string(128),
  password: string
}
```

#### Response (Success)

statusCode: 200
response object:
```sh
{ 
  "status": 'success',
  "message": `Registered Successfully. Welcome, ${username}.`
  "token": `${token}`,
  "user": {
    "id": id,
    "username": `${username}`
  }
  "role": 'user'
}
```
user's id is a number.

### Login

#### Endpoint

```sh
POST /api/auth/login
URL: https://build-week-expat-journal-1.herokuapp.com/api/auth/login
```

#### Request Body

request object:
```sh
{ 
  username: string(128),
  password: string(255)
}
```

#### Response (Success)

statusCode: 200
response object:
```sh
{ 
  "status": 'success',
  "message": `Welcome, ${username}.`,
  "token": `${token}`,
  "user": {
    "id": id,
    "username": `${username}`
  }
  "role": 'user'
}
```
user id is a number.

## 2. CRUD Stories and Photos

Endpoints for a user creates, reads, updates and deletes his/her stories and photos

### Database Schemas

The resources for CRUD stories and photos

#### Stories
| Field     | Data Type        | Metadata                                             |
| --------- | -----------------| ---------------------------------------------------- |
| id        | unsigned integer | primary key, auto-increments, generated by database  |
| title     | string           | required, max length of 255 characters               |
| teaser    | string           | required, max length of 255 characters               |
| content   | text             | required, holding a string of 65,535 bytes           |
| user_id   | unsigned integer | required, foreign key, ref: 'id' from 'users' table  |
| created_at| datetime         | default value 'now'                                  |

#### Photos
| Field     | Data Type        | Metadata                                             |
| --------- | -----------------| ---------------------------------------------------- |
| id        | unsigned integer | primary key, auto-increments, generated by database  |
| image_url | text             | required, unique, holding a string of 65,535 bytes   |
| desc      | text             | required, holding a string of 65,535 bytes           | 
| story_id  | unsigned integer | required, foreign key, ref: 'id' from 'stories table |
| created_at| datetime         | default value 'now'                                  |

### Create a Story

#### Endpoint

```sh
POST /api/stories
URL: https://build-week-expat-journal-1.herokuapp.com/api/stories
```

#### Request Body

request object:
```sh
{ 
  title: string 225,
  teaser: string 255,
  content: text,
  user_id: unsigned integer,
  photos: [
    { 
      image_url: string,
      desc: string
    }
    ...
  ]
}
```
'photos' array is optional and can have 1 or more photo objects.

#### Response (Success)

statusCode: 201
response object:
```sh
{ 
  "status": "success",
  "story": [
    "id": id
  ]
}
```
story's id, a number, is the id of the story just has been created.

### Read Stories

#### Endpoint

```sh
GET /api/stories
URL: https://build-week-expat-journal-1.herokuapp.com/api/stories
```

#### Request Body

request object: None

#### Response (Success)

statusCode: 201
response object:
```sh
{
  "status": "success",
  "stories": [
    {
      "id": story_id,
      "title": `${title}`,
      "teaser": `${teaser}`,
      "content": `${content}`,
      "user_id": user_id,
      "created_at": `${created_at}`,
      "photos": [
        {
          "id": photo_id,
          "image_url": `${image_url}`,
          "desc": `${desc}`,
          "created_at": `${created_at}`,
          "story_id": story_id
        }
        ...
      ]
    },
    ...
  ]
}
```
story's id, user's id and photo's id are numbers

### Read a Story By Id

#### Endpoint

```sh
GET /api/stories/:id
URL: https://build-week-expat-journal-1.herokuapp.com/api/stories/:id
```
':id' is story's id

#### Request Body

request object: None

#### Response (Success)

statusCode: 200
response object sample:
```sh
{
  "status": "success",
  "story": {
    "id": story_id,
    "title": `${title}`,
    "teaser": `${teaser}`,
    "content": `${content}`,
    "user_id": user_id,
    "created_at": `${created_at}`,
    "photos": [
      {
        "id": photo_id,
        "image_url": `${image_url}`,
        "desc": `${desc}`,
        "created_at": `${created_at}`,
        "story_id": story_id
      }
      ...
    ]
  }
}
```
story's id, user's id and photo's id are numbers

### Update a Story By Id

#### Endpoint

```sh
PUT /api/stories/:id
URL: https://build-week-expat-journal-1.herokuapp.com/api/stories/:id
```
':id' is story's id

#### Request Body

request object:
```sh
{ 
  "title": sting,
  "teaser": sting,
  "content": text,
  "user_id": unsigned integer,
  "photos": [
    {
      "id": unsigned integer,
      "image_url": string,
      "desc": string
    },
    {
      "image_url": string,
      "desc": string
    }
  ]
}
```
if there is NO photo Id in a photo object then the photo object will be created as a new photo.

#### Response (Success)

statusCode: 200
response object sample:
```sh
{
  "status": "success",
  "story": {
    "id": story_id,
    "title": `${title}`,
    "teaser": `${teaser}`,
    "content": `${content}`,
    "user_id": user_id,
    "created_at": `${created_at}`,
    "photos": [
      {
        "id": photo_id,
        "image_url": `${image_url}`,
        "desc": `${desc}`,
        "created_at": `${created_at}`,
        "story_id": story_id
      }
      {
        "id": photo_id,
        "image_url": `${image_url}`,
        "desc": `${desc}`,
        "created_at": `${created_at}`,
        "story_id": story_id
      }
    ]
  }
}
```
The first photo object has been updated, the second photo object has just been created with a new photo Id.

### Delete a Story By Id

#### Endpoint

```sh
DELETE /api/stories/:id
URL: https://build-week-expat-journal-1.herokuapp.com/api/stories/:id
```
':id' is story's id

#### Request Body

request object: none

#### Response (Success)

statusCode: 200
response object:
```sh
{
  "status": "success",
  "message": "The story and its photos have been removed."
}
```

### Add a Photo by Id

#### Endpoint

```sh
POST /api/stories/6/photos
URL: https://build-week-expat-journal-1.herokuapp.com/api/stories/:id/photos
```
':id' is a story's id.

#### Request Body

request object:
```sh
{
  "image_url": `${image_url}`,
  "desc": `${desc}`
}
```

#### Response (Success)

statusCode: 200
response object:
```sh
{
  "status": 'success',
  "photo": [
    id
  ] 
}
```
id is a new id of the photo just has been added.

### Delete a Photo by Id

#### Endpoint

```sh
POST /api/stories/6/photos
URL: https://build-week-expat-journal-1.herokuapp.com/api/stories/:id/photos/:pid
```
':id' is a story's id.
':pid' is a photo's id needs to be deleted.

#### Request Body

request object: none

#### Response (Success)

statusCode: 200
response object:
```sh
{ 
  "status": "success",
  "message": "The photo has been removed."
}
```


